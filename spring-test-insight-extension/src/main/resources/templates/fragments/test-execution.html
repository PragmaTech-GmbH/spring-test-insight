<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="test-execution-section(testClassData)">
        <h2>Test Execution Details</h2>
        <div class="execution-overview">
            <p>Click on any test class below to expand and see detailed information about individual test methods, including execution times and failure details.</p>
        </div>
        
        <div th:each="classData : ${testClassSorter.sortTestClasses(testClassData)}"
             th:with="classExecutionTimeMs=${summaryCalculator.getClassExecutionTime(classData)},
                      classStatusColor=${statusColorHelper.getClassStatusColor(classData)}"
             class="test-class">
            
            <div class="test-class-header" 
                 onclick="toggleClass(this)" 
                 th:style="${'border-left: 4px solid ' + classStatusColor + ';'}">
                <div>
                    <div class="test-class-name" th:text="${classNameHelper.getSimpleClassName(classData.className)}">TestClass</div>
                    <div class="test-class-package" th:text="${classNameHelper.getPackageName(classData.className)}">com.example.test</div>
                </div>
                <div class="test-class-stats">
                    <span>‚è±Ô∏è <span th:text="${durationFormatter.format(classExecutionTimeMs)}">0ms</span></span>
                    <span>üìä <span th:text="${classData.totalTests + ' tests'}">0 tests</span></span>
                    
                    <span th:if="${classData.passedTests > 0}" style="color: #27ae60;">
                        ‚úÖ <span th:text="${classData.passedTests}">0</span>
                    </span>
                    <span th:if="${classData.failedTests > 0}" style="color: #e74c3c;">
                        ‚ùå <span th:text="${classData.failedTests}">0</span>
                    </span>
                    <span th:if="${classData.disabledTests > 0}" style="color: #95a5a6;">
                        ‚è∏Ô∏è <span th:text="${classData.disabledTests}">0</span>
                    </span>
                    <span th:if="${classData.abortedTests > 0}" style="color: #f39c12;">
                        ‚ö†Ô∏è <span th:text="${classData.abortedTests}">0</span>
                    </span>
                </div>
            </div>
            
            <div class="test-methods">
                <!-- Spring context info for this class -->
                <div th:if="${classData.contextStatistics != null and (classData.contextStatistics.contextLoads > 0 or classData.contextStatistics.cacheHits > 0)}" 
                     class="context-info">
                    <h4>üèóÔ∏è Spring Context Information</h4>
                    <div class="context-metrics">
                        <span th:if="${classData.contextStatistics.contextLoads > 0}" 
                              class="context-metric">
                            üîÑ Context Loads: <span th:text="${classData.contextStatistics.contextLoads}">0</span>
                        </span>
                        <span th:if="${classData.contextStatistics.cacheHits > 0}" 
                              class="context-metric">
                            üéØ Cache Hits: <span th:text="${classData.contextStatistics.cacheHits}">0</span>
                        </span>
                        <span th:if="${classData.contextStatistics.totalContextLoadTime.toMillis() > 0}" 
                              class="context-metric">
                            ‚è±Ô∏è Load Time: <span th:text="${durationFormatter.format(classData.contextStatistics.totalContextLoadTime.toMillis())}">0ms</span>
                        </span>
                    </div>
                </div>
                
                <!-- Test methods sorted by status (failed first, then by name) -->
                <div th:each="testData : ${testMethodSorter.sortTestMethods(classData.testExecutions.values())}"
                     th:with="statusClass=${#strings.toLowerCase(testData.status)},
                              statusIcon=${statusIconHelper.getStatusIcon(testData.status)}"
                     th:class="${'test-method ' + statusClass}">
                    
                    <div class="test-method-header">
                        <span class="test-method-name">
                            <span th:text="${statusIcon}">‚úÖ</span> 
                            <span th:text="${testData.testMethodName}">testMethod</span>
                        </span>
                        <div class="test-method-info">
                            <span th:if="${testData.duration != null}" 
                                  class="test-duration" 
                                  th:text="${durationFormatter.format(testData.duration.toMillis())}">0ms</span>
                            <span class="test-status" th:text="${testData.status}">PASSED</span>
                        </div>
                    </div>
                    
                    <div th:if="${testData.throwable != null}" class="error-details">
                        <h5>Error Details:</h5>
                        <pre th:text="${errorFormatter.formatError(testData.throwable)}">Error message</pre>
                    </div>
                    
                    <div th:if="${testData.reason != null and !#strings.isEmpty(#strings.trim(testData.reason))}" 
                         class="test-reason">
                        <strong>Reason:</strong> <span th:text="${testData.reason}">Reason text</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>